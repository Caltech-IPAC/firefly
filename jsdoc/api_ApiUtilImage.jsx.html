<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>api/ApiUtilImage.jsx - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-firefly_util_image_CCUtil.CysConverter.CysConverter.html">CysConverter</a></li></ul><h3>Modules</h3><ul><li><a href="module-firefly_action.html">firefly/action</a><ul class='methods'><li data-type='method'><a href="module-firefly_action.html#~createDrawLayer">createDrawLayer</a></li><li data-type='method'><a href="module-firefly_action.html#~deferToLayerReducer">deferToLayerReducer</a></li><li data-type='method'><a href="module-firefly_action.html#~destroyDrawLayer">destroyDrawLayer</a></li><li data-type='method'><a href="module-firefly_action.html#~determineAndCallLayerReducer">determineAndCallLayerReducer</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchAddRegionEntry">dispatchAddRegionEntry</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchAttachLayerToPlot">dispatchAttachLayerToPlot</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchChangeDrawingDef">dispatchChangeDrawingDef</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchChangeVisibility">dispatchChangeVisibility</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchCreateDrawLayer">dispatchCreateDrawLayer</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchCreateRegionLayer">dispatchCreateRegionLayer</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchDeleteRegionLayer">dispatchDeleteRegionLayer</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchDestroyDrawLayer">dispatchDestroyDrawLayer</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchDetachLayerFromPlot">dispatchDetachLayerFromPlot</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchLoadPlotData">dispatchLoadPlotData</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchModifyCustomField">dispatchModifyCustomField</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchRemoveRegionEntry">dispatchRemoveRegionEntry</a></li><li data-type='method'><a href="module-firefly_action.html#.dispatchRetrieveData">dispatchRetrieveData</a></li><li data-type='method'><a href="module-firefly_action.html#~fetchPlotData">fetchPlotData</a></li><li data-type='method'><a href="module-firefly_action.html#~getPaddedBoundaries">getPaddedBoundaries</a></li><li data-type='method'><a href="module-firefly_action.html#~makeReducer">makeReducer</a></li><li data-type='method'><a href="module-firefly_action.html#~updatePlotData">updatePlotData</a></li></ul></li><li><a href="module-firefly_util.html">firefly/util</a><ul class='methods'><li data-type='method'><a href="module-firefly_util.html#.addActionListener">addActionListener</a></li><li data-type='method'><a href="module-firefly_util.html#.debug">debug</a></li><li data-type='method'><a href="module-firefly_util.html#~renderDOM">renderDOM</a></li><li data-type='method'><a href="module-firefly_util.html#~unrenderDOM">unrenderDOM</a></li></ul></li><li><a href="module-firefly_util_image.html">firefly/util/image</a><ul class='methods'><li data-type='method'><a href="module-firefly_util_image.html#.initAutoReadout">initAutoReadout</a></li><li data-type='method'><a href="module-firefly_util_image.html#.serializeSimpleRangeValues">serializeSimpleRangeValues</a></li></ul></li><li><a href="module-firefly_util_image_CCUtil.html">firefly/util/image/CCUtil</a><ul class='methods'><li data-type='method'><a href="module-firefly_util_image_CCUtil.html#~getImageCoords">getImageCoords</a></li><li data-type='method'><a href="module-firefly_util_image_CCUtil.html#~getScreenCoords">getScreenCoords</a></li><li data-type='method'><a href="module-firefly_util_image_CCUtil.html#~getViewPortCoords">getViewPortCoords</a></li><li data-type='method'><a href="module-firefly_util_image_CCUtil.html#~getWorldCoords">getWorldCoords</a></li><li data-type='method'><a href="module-firefly_util_image_CCUtil.html#~getWorldPtRepresentation">getWorldPtRepresentation</a></li></ul></li><li><a href="module-firefly_util_table.html">firefly/util/table</a><ul class='methods'><li data-type='method'><a href="module-firefly_util_table.html#.calcColumnWidths">calcColumnWidths</a></li><li data-type='method'><a href="module-firefly_util_table.html#.cloneRequest">cloneRequest</a></li><li data-type='method'><a href="module-firefly_util_table.html#.doFetchTable">doFetchTable</a></li><li data-type='method'><a href="module-firefly_util_table.html#.error">error</a></li><li data-type='method'><a href="module-firefly_util_table.html#.findGroupByTblId">findGroupByTblId</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getCellValue">getCellValue</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTableGroup">getTableGroup</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTableInGroup">getTableInGroup</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTableSourceUrl">getTableSourceUrl</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTableUiById">getTableUiById</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTableUiByTblId">getTableUiByTblId</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTblExpandedInfo">getTblExpandedInfo</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTblIdsByGroup">getTblIdsByGroup</a></li><li data-type='method'><a href="module-firefly_util_table.html#.getTblInfo">getTblInfo</a></li><li data-type='method'><a href="module-firefly_util_table.html#.isFullyLoaded">isFullyLoaded</a></li><li data-type='method'><a href="module-firefly_util_table.html#.isTableLoaded">isTableLoaded</a></li><li data-type='method'><a href="module-firefly_util_table.html#.isTblDataAvail">isTblDataAvail</a></li><li data-type='method'><a href="module-firefly_util_table.html#.makeFileRequest">makeFileRequest</a></li><li data-type='method'><a href="module-firefly_util_table.html#.makeIrsaCatalogRequest">makeIrsaCatalogRequest</a></li><li data-type='method'><a href="module-firefly_util_table.html#.makeTblRequest">makeTblRequest</a></li><li data-type='method'><a href="module-firefly_util_table.html#.smartMerge">smartMerge</a></li><li data-type='method'><a href="module-firefly_util_table.html#.sortTable">sortTable</a></li><li data-type='method'><a href="module-firefly_util_table.html#.sortTableData">sortTableData</a></li><li data-type='method'><a href="module-firefly_util_table.html#.transform">transform</a></li></ul></li><li><a href="module-highLevelApi.html">highLevelApi</a><ul class='methods'><li data-type='method'><a href="module-highLevelApi.html#~addXYPlot">addXYPlot</a></li><li data-type='method'><a href="module-highLevelApi.html#~getViewer">getViewer</a></li><li data-type='method'><a href="module-highLevelApi.html#~setGlobalImageDef">setGlobalImageDef</a></li><li data-type='method'><a href="module-highLevelApi.html#~showCoverage">showCoverage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImage">showImage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImageFileOrUrl">showImageFileOrUrl</a></li><li data-type='method'><a href="module-highLevelApi.html#~showTable">showTable</a></li><li data-type='method'><a href="module-highLevelApi.html#~showXYPlot">showXYPlot</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-firefly-api-code-examples.html">firefly-api-code-examples</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">api/ApiUtilImage.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
 */

import React from 'react';
import {take,race,call} from 'redux-saga/effects';
import {MouseState} from '../visualize/VisMouseSync.js';
import ImagePlotCntlr, {visRoot, ExpandType} from '../visualize/ImagePlotCntlr.js';
import {primePlot} from '../visualize/PlotViewUtil.js';
import {dispatchAddSaga} from '../core/MasterSaga.js';
import  {DefaultApiReadout} from '../visualize/ui/DefaultApiReadout.jsx';
//import  {PopupMouseReadoutMinimal} from '../visualize/ui/PopupMouseReadoutMinimal.jsx';
import  {PopupMouseReadoutFull} from '../visualize/ui/PopupMouseReadoutFull.jsx';
import DialogRootContainer from '../ui/DialogRootContainer.jsx';
import {PopupPanel, LayoutType} from '../ui/PopupPanel.jsx';
import {dispatchShowDialog,dispatchHideDialog, isDialogVisible} from '../core/ComponentCntlr.js';
import {readoutRoot,isAutoReadIsLocked, isLockByClick,STANDARD_READOUT} from '../visualize/MouseReadoutCntlr.js';
import {mouseUpdatePromise} from '../visualize/VisMouseSync.js';
import {RangeValues} from '../visualize/RangeValues.js';
const API_READOUT= 'apiReadout';

// NOTE 
// NOTE 
//----------------------------------------------------------------
// Anything that is exported here becomes part of the lowlevel API
// It should have a jsdoc
//----------------------------------------------------------------
// NOTE 
// NOTE 

export {RangeValues} from '../visualize/RangeValues.js';
export {WPConst, WebPlotRequest, findInvalidWPRKeys, confirmPlotRequest} from '../visualize/WebPlotRequest.js';
export {RequestType} from '../visualize/RequestType';
export {ExpandType, dispatchApiToolsView} from '../visualize/ImagePlotCntlr.js';
/**
 * @module firefly/util/image
 *
 */
export {CsysConverter} from '../visualize/CsysConverter.js';
export {CCUtil} from '../visualize/CsysConverter.js';
export {watchCoverage} from '../visualize/saga/CoverageWatcher.js';
export {watchImageMetaData} from '../visualize/saga/ImageMetaDataWatcher.js';


/*
 *
 *
 *
 * Get plot object with the given plot id.
 * When plotId is not included, active plot is returned.
 */
/**
 * @param {string} [plotId] the plotId, optional
 *
 * @returns {WebPlot}
 * @memberof firefly/util/image
 *
 */
export function getPrimePlot(plotId) {
    return primePlot(visRoot(), plotId);
}

/**
 * initialize the auto readout. Must be call once at the begging to get the popup readout running.
 *
 */
/**
 * @param {object} ReadoutComponent - either a PopupMouseReadoutMinimal or PopupMouseReadoutFull
 * @param {object} props - a list of the properties
 */
export function initAutoReadout(ReadoutComponent= DefaultApiReadout,
         //   props={MouseReadoutComponent:PopupMouseReadoutMinimal, showThumb:false,showMag:false}){
      props={MouseReadoutComponent:PopupMouseReadoutFull, showThumb:true,showMag:true } ){


    dispatchAddSaga(autoReadoutVisibility, {ReadoutComponent,props});
}


/**
 *
 * @param stretchType the type of stretch may be 'Percent', 'Absolute', 'Sigma'
 * @param lowerValue lower value of stretch, based on stretchType
 * @param upperValue upper value of stretch, based on stretchType
 * @param algorithm the stretch algorithm to use, may be 'Linear', 'Log', 'LogLog', 'Equal', 'Squared', 'Sqrt'
 */
export function serializeSimpleRangeValues(stretchType,lowerValue,upperValue,algorithm) {
    const rv= RangeValues.makeSimple(stretchType,lowerValue,upperValue,algorithm);
    return rv.toJSON();
}


//========== Private ================================
//========== Private ================================
//========== Private ================================
//========== Private ================================

const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

function *autoReadoutVisibility({ReadoutComponent,props}) {
    var inDialog= false;
    var showing;
    var mouseState;
    // var action;
    var doYield= true;
    var winner;
    while (true) {
        // if (doYield) action= yield take([MOUSE_STATE_CHANGE, ImagePlotCntlr.CHANGE_EXPANDED_MODE]);

        if (doYield) {
            winner = yield race({
                expandedChange: take([ImagePlotCntlr.CHANGE_EXPANDED_MODE]),
                mouse: call(mouseUpdatePromise)
            });
        }


        doYield= true;
        if (winner.mouse) {
            mouseState = winner.mouse.mouseState;
        }
        if (visRoot().expandedMode!==ExpandType.COLLAPSE) {
            hideReadout();
            continue;
        }
        if (!mouseState) continue;
        showing= isDialogVisible(API_READOUT);
        if (mouseState!==MouseState.EXIT &amp;&amp; !showing) {
            showReadout(ReadoutComponent,props, (inD) => {
                inDialog= inD;
            });
        }
        else if (mouseState===MouseState.EXIT &amp;&amp; showing) {
             winner = yield race({
                           expandedChange: take([ImagePlotCntlr.CHANGE_EXPANDED_MODE]),
                           mouse: call(mouseUpdatePromise),
                           timer: call(delay, 3000)
                         });
            if ((!winner.expandedChange || !winner.mouse) &amp;&amp; !inDialog &amp;&amp; !isLockByClick(readoutRoot()) &amp;&amp; !isAutoReadIsLocked(readoutRoot())) {
                hideReadout();
            }
            else {
                doYield= false;
            }
        }
    }
}



function showReadout(DefaultApiReadout, props={},  mouseInDialog) {

    const  readout=readoutRoot();
    const title = readout[STANDARD_READOUT] &amp;&amp; readout[STANDARD_READOUT].readoutItems  &amp;&amp; readout[STANDARD_READOUT].readoutItems.title?readout[STANDARD_READOUT].readoutItems.title.value:'';
    const popup= (
        &lt;PopupPanel title={title} layoutPosition={LayoutType.TOP_RIGHT} mouseInDialog={mouseInDialog} >
            &lt;DefaultApiReadout {...props} />
        &lt;/PopupPanel>
    );
    DialogRootContainer.defineDialog(API_READOUT, popup);
    dispatchShowDialog(API_READOUT);
}

function hideReadout() {
    if (isDialogVisible(API_READOUT)) dispatchHideDialog(API_READOUT);
}

</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Aug 12 2016 16:23:56 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
