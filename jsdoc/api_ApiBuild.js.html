<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>api/ApiBuild.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-lowLevelApi.CysConverter.CysConverter.html">CysConverter</a></li></ul><h3>Modules</h3><ul><li><a href="module-highLevelApi.html">highLevelApi</a><ul class='methods'><li data-type='method'><a href="module-highLevelApi.html#~addXYPlot">addXYPlot</a></li><li data-type='method'><a href="module-highLevelApi.html#~getViewer">getViewer</a></li><li data-type='method'><a href="module-highLevelApi.html#~setGlobalImageDef">setGlobalImageDef</a></li><li data-type='method'><a href="module-highLevelApi.html#~showCoverage">showCoverage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImage">showImage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImageFileOrUrl">showImageFileOrUrl</a></li><li data-type='method'><a href="module-highLevelApi.html#~showTable">showTable</a></li><li data-type='method'><a href="module-highLevelApi.html#~showXYPlot">showXYPlot</a></li></ul></li><li><a href="module-lowLevelApi.html">lowLevelApi</a><ul class='methods'><li data-type='method'><a href="module-lowLevelApi.html#.addActionListener">addActionListener</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchAddRegionEntry">dispatchAddRegionEntry</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchCreateRegionLayer">dispatchCreateRegionLayer</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchDeleteRegionLayer">dispatchDeleteRegionLayer</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchLoadPlotData">dispatchLoadPlotData</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchRemoveRegionEntry">dispatchRemoveRegionEntry</a></li><li data-type='method'><a href="module-lowLevelApi.html#.getPrimePlot">getPrimePlot</a></li><li data-type='method'><a href="module-lowLevelApi.html#.initAutoReadout">initAutoReadout</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeFileRequest">makeFileRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeIrsaCatalogRequest">makeIrsaCatalogRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeTblRequest">makeTblRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#.serializeSimpleRangeValues">serializeSimpleRangeValues</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getImageCoords">getImageCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getScreenCoords">getScreenCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getViewPortCoords">getViewPortCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getWorldCoords">getWorldCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getWorldPtRepresentation">getWorldPtRepresentation</a></li><li data-type='method'><a href="module-lowLevelApi.html#~renderDOM">renderDOM</a></li><li data-type='method'><a href="module-lowLevelApi.html#~unrenderDOM">unrenderDOM</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="module-lowLevelApi-firefly.html">firefly</a></li><li><a href="module-lowLevelApi-firefly_action.html">firefly/action</a></li><li><a href="module-lowLevelApi-firefly_ui.html">firefly/ui</a></li><li><a href="module-lowLevelApi-firefly_util.html">firefly/util</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-firefly-api-code-examples.html">firefly-api-code-examples</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">api/ApiBuild.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
 */

import {isString} from 'lodash';
import {dispatchOnAppReady} from '../core/AppDataCntlr.js';

// Used for dispatch and action type constants
import * as TableStatsCntlr from '../charts/TableStatsCntlr.js';
import * as HistogramCntlr from '../charts/HistogramCntlr.js';
import * as XYPlotCntlr from '../charts/XYPlotCntlr.js';
import * as TablesCntlr from '../tables/TablesCntlr.js';
import * as ReadoutCntlr from '../visualize/MouseReadoutCntlr.js';
import * as ImPlotCntlr from '../visualize/ImagePlotCntlr.js';
import * as MultiViewCntlr from '../visualize/MultiViewCntlr.js';
import * as AppDataCntlr from '../core/AppDataCntlr.js';
import * as DrawLayerCntlr from '../visualize/DrawLayerCntlr.js';
import {ApiExpandedView} from './ApiExpandedView.jsx';
import {dispatchAddSaga} from '../core/MasterSaga.js';

// Parts of the lowlevel api
import * as ApiUtil from './ApiUtil.js';
import  * as ApiUtilChart from './ApiUtilChart.jsx';
import  * as ApiUtilImage from './ApiUtilImage.jsx';
import  * as ApiUtilTable from './ApiUtilTable.jsx';

// UI component
import {MultiImageViewer} from '../visualize/ui/MultiImageViewer.jsx';
import {ImageViewer} from '../visualize/iv/ImageViewer.jsx';
import {ImageMetaDataToolbar} from '../visualize/ui/ImageMetaDataToolbar.jsx';
import {MultiViewStandardToolbar} from '../visualize/ui/MultiViewStandardToolbar.jsx';
import {ExpandedModeDisplay} from '../visualize/iv/ExpandedModeDisplay.jsx';
import {ApiExpandedDisplay} from '../visualize/ui/ApiExpandedDisplay.jsx';
import {TablesContainer} from '../tables/ui/TablesContainer.jsx';
import {TablePanel} from '../tables/ui/TablePanel.jsx';
import {ChartsContainer} from '../charts/ui/ChartsContainer.jsx';
import {ChartsTableViewPanel} from '../charts/ui/ChartsTableViewPanel.jsx';
import {PopupMouseReadoutMinimal} from  '../visualize/ui/PopupMouseReadoutMinimal.jsx';
import {PopupMouseReadoutFull} from  '../visualize/ui/PopupMouseReadoutFull.jsx';


// builds the highlevel api
import {buildHighLevelApi} from './ApiHighlevelBuild.js';
import {buildViewerApi} from './ApiViewer.js';



// CSS
import './ApiStyle.css';


/*
 * Start in api mode. Will create the api and call window.onFireflyLoaded(firefly)
 */
export function initApi() {
    /**
     * @desc  build lowLevelApi
     * @module lowLevelApi
     * @type {{action, ui, util}|{action: {}, ui: {}, util: {}}}
     */
    const lowlevelApi= buildLowlevelAPI();
    const viewInterface= buildViewerApi();

    const highLevelApi= buildHighLevelApi(lowlevelApi);
    if (!window.firefly) window.firefly= {};
    window.firefly.ignoreHistory = true;
    Object.assign(window.firefly, lowlevelApi, highLevelApi, viewInterface);
    /**
     * @namespace firefly
     * @desc Eefine the firefly object that includes highLevelApi and lowLevelApi and the viewInterface
     * @type {{}|*}
     */
    const firefly= window.firefly;
    dispatchOnAppReady(() => {
        window.onFireflyLoaded &amp;&amp; window.onFireflyLoaded(firefly);
    });
    initExpandedView();
}



/*
Structure of API
   {
              //--- High level API , all high level api are in the root
     all high level functions....
     
            //--- Low level API, lowlevel api are under action, ui, util
     action : { all dispatch functions...
               type: {all action type constants}
              }
     ui: { high level react components }
     util { renderDom, unrenderDom, isDebug, debug       // built by ApiUtil.js
            image : {image utility routines}                // imported from ApiUtilImage.js
            xyplot : {xyplot utility routines}               // imported from ApiUtilXYPlot.js //todo
            table : {table utility routines}                // imported from ApiUtilTable.js //todo
            data : {data utility routines???? }            // //todo do we need this?????
     }
   }
*/



/*
 * Return the api object.
 * @return {{action:{},ui:{},util:{}}}
 *
 */
export function buildLowlevelAPI() {


    const type= Object.assign({},
        findActionType(TableStatsCntlr,TableStatsCntlr.TBLSTATS_DATA_KEY),
        findActionType(HistogramCntlr, HistogramCntlr.HISTOGRAM_DATA_KEY),
        findActionType(XYPlotCntlr, XYPlotCntlr.XYPLOT_DATA_KEY ),
        findActionType(TablesCntlr, TablesCntlr.DATA_PREFIX),
        findActionType(TablesCntlr, TablesCntlr.RESULTS_PREFIX),
        findActionType(TablesCntlr, TablesCntlr.UI_PREFIX),
        findActionType(ReadoutCntlr, ReadoutCntlr.READOUT_PREFIX),
        findActionType(MultiViewCntlr, MultiViewCntlr.IMAGE_MULTI_VIEW_PREFIX),
        findActionType(ImPlotCntlr.default, ImPlotCntlr.PLOTS_PREFIX),
        findActionType(AppDataCntlr, AppDataCntlr.APP_DATA_PATH),
        findActionType(DrawLayerCntlr.default, DrawLayerCntlr.DRAWLAYER_PREFIX)
    );

    /**
     * @desc loweverApi firefly.action
     * @namespace firefly/action
     * @memeberof lowLevelApi
     * @type {*}
     */
    const action= Object.assign({},
        {type},
        findDispatch(TableStatsCntlr),
        findDispatch(HistogramCntlr),
        findDispatch(XYPlotCntlr),
        findDispatch(TablesCntlr),
        findDispatch(ReadoutCntlr),
        findDispatch(MultiViewCntlr),
        findDispatch(ImPlotCntlr),
        findDispatch(AppDataCntlr),
        findDispatch(DrawLayerCntlr),
        {dispatchAddSaga}
    );

    /**
     * @desc lowLevelApi
     * @namespace firefly/ui
     * @memeberof lowLevelApi
     * @type {{ImageViewer: ImageViewer, MultiImageViewer: MultiImageViewer, MultiViewStandardToolbar: MultiViewStandardToolbar, ApiExpandedDisplay: ApiExpandedDisplay, ExpandedModeDisplay: ExpandedModeDisplay, ImageMetaDataToolbar: ImageMetaDataToolbar, TablesContainer: TablesContainer, TablePanel: TablePanel, ChartsContainer: ChartsContainer, ChartsTableViewPanel: ChartsTableViewPanel, PopupMouseReadoutMinimal: PopupMouseReadoutMinimal, PopupMouseReadoutFull: PopupMouseReadoutFull}}
     */
    const ui= {
        ImageViewer,
        MultiImageViewer,
        MultiViewStandardToolbar,
        ApiExpandedDisplay,
        ExpandedModeDisplay,
        ImageMetaDataToolbar,
        TablesContainer,
        TablePanel,
        ChartsContainer,
        ChartsTableViewPanel,
        PopupMouseReadoutMinimal,
        PopupMouseReadoutFull
    };
    /**
     * @desc lowLevelApi
     * @namespace firefly/util
     * @memeberof lowLevelApi
     * @type {*}
     */
    const util= Object.assign({}, ApiUtil, {image:ApiUtilImage}, {chart:ApiUtilChart}, {table:ApiUtilTable}, {data:{}} );

    return { action, ui, util };
}


/*
 * pull all the dispatch functions out of the object
 * @param obj
 * @return {*}
 */
function findDispatch(obj) {
   return Object.keys(obj).reduce( (res,key) => {
        if (key.startsWith('dispatch')) res[key]= obj[key];
        return res;
    },{} );
}


/*
 * pull all the action type constants out of the object
 * @param obj
 * @param prefix
 * @return {*}
 */
function findActionType(obj,prefix) {
    return Object.keys(obj).reduce( (res,key) => {
        if (isString(obj[key]) &amp;&amp; obj[key].startsWith(prefix) &amp;&amp; obj[key].length>prefix.length) {
            res[key]= obj[key];
        }
        return res;
    },{} );
}


function initExpandedView(div){

    const EXPANDED_DIV= 'expandedArea';
    var expandedDivEl;
    if (div) {
        expandedDivEl= isString(div) ? document.getElementById(div) : div;
    } else {
        expandedDivEl= document.createElement('div');
        document.body.appendChild(expandedDivEl);
        expandedDivEl.id= EXPANDED_DIV;
    }
    
    ApiUtil.renderDOM(expandedDivEl, ApiExpandedView);
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Thu Aug 11 2016 13:54:38 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
