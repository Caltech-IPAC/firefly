<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>api/ApiUtil.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-lowLevelApi.CysConverter.CysConverter.html">CysConverter</a></li></ul><h3>Modules</h3><ul><li><a href="module-highLevelApi.html">highLevelApi</a><ul class='methods'><li data-type='method'><a href="module-highLevelApi.html#~addXYPlot">addXYPlot</a></li><li data-type='method'><a href="module-highLevelApi.html#~getViewer">getViewer</a></li><li data-type='method'><a href="module-highLevelApi.html#~setGlobalImageDef">setGlobalImageDef</a></li><li data-type='method'><a href="module-highLevelApi.html#~showCoverage">showCoverage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImage">showImage</a></li><li data-type='method'><a href="module-highLevelApi.html#~showImageFileOrUrl">showImageFileOrUrl</a></li><li data-type='method'><a href="module-highLevelApi.html#~showTable">showTable</a></li><li data-type='method'><a href="module-highLevelApi.html#~showXYPlot">showXYPlot</a></li></ul></li><li><a href="module-lowLevelApi.html">lowLevelApi</a><ul class='methods'><li data-type='method'><a href="module-lowLevelApi.html#.addActionListener">addActionListener</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchAddRegionEntry">dispatchAddRegionEntry</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchCreateRegionLayer">dispatchCreateRegionLayer</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchDeleteRegionLayer">dispatchDeleteRegionLayer</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchLoadPlotData">dispatchLoadPlotData</a></li><li data-type='method'><a href="module-lowLevelApi.html#.dispatchRemoveRegionEntry">dispatchRemoveRegionEntry</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getImageCoords">getImageCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#.getPrimePlot">getPrimePlot</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getScreenCoords">getScreenCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getViewPortCoords">getViewPortCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getWorldCoords">getWorldCoords</a></li><li data-type='method'><a href="module-lowLevelApi.html#~getWorldPtRepresentation">getWorldPtRepresentation</a></li><li data-type='method'><a href="module-lowLevelApi.html#.initAutoReadout">initAutoReadout</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeFileRequest">makeFileRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeIrsaCatalogRequest">makeIrsaCatalogRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#.makeTblRequest">makeTblRequest</a></li><li data-type='method'><a href="module-lowLevelApi.html#~renderDOM">renderDOM</a></li><li data-type='method'><a href="module-lowLevelApi.html#.serializeSimpleRangeValues">serializeSimpleRangeValues</a></li><li data-type='method'><a href="module-lowLevelApi.html#~unrenderDOM">unrenderDOM</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="module-lowLevelApi-firefly.html">firefly</a></li><li><a href="module-lowLevelApi-firefly_action.html">firefly/action</a></li><li><a href="module-lowLevelApi-firefly_ui.html">firefly/ui</a></li><li><a href="module-lowLevelApi-firefly_util.html">firefly/util</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-firefly-api-code-examples.html">firefly-api-code-examples</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">api/ApiUtil.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
 */


import React, {Component} from 'react';
import ReactDOM from 'react-dom';
import {get,isEmpty} from 'lodash';
import {isElement,isString} from 'lodash';
import {logErrorWithPrefix} from '../util/WebUtil.js';
import {dispatchAddSaga} from '../core/MasterSaga.js';
import {take,race,call} from 'redux-saga/effects';

// NOTE 
// NOTE 
//------------------------------------------------------------------------------------------
// Anything that is exported here becomes part of the lowlevel API
// It should have a jsdoc
//------------------------------------------------------------------------------------------
// NOTE 
// NOTE
/**
 * @module lowLevelApi
 */
export {getBoolean} from '../util/WebUtil.js';
export {toBoolean} from '../util/WebUtil.js';


/*
 * Is in debug mode
 * @Function isDebug
 */


export const isDebug = () => get(window, 'firefly.debug', false);

/*
 * show a debug message if debugging is enabled
 * @param {String|Error} msg any number of messages
 */
export function debug(...msg) {
    if (isDebug() &amp;&amp; !isEmpty(msg)) {
        logErrorWithPrefix('Firefly:', ...msg);
    }
}



/**
 *
 * @param {string|Object} div a div element or a string id of the div element
 * @param {Object} Component a react component
 * @param {Object} [props] props for the react component
 * @memeberof lowLevelApi
 * @Function renderDOM
 */
export function renderDOM(div, Component, props) {
    const divElement= isString(div) ? document.getElementById(div) : div;

    if (!isElement(divElement)) debug(`the div element ${isString(div)?div:''} is not defined in the html` );
    if (!Component) debug('Component must be defined');
    divElement.classList.add('rootStyle');

    const renderStuff= (
            &lt;Component {...props} />
    );

    ReactDOM.render(renderStuff,divElement);
}


/**
 *
 * removed the rendered element
 */
/**
 * @param {string|Object} div a div element or a string id of the div element
 * @Function unrenderDOM
 * @memeberof lowLevelApi
 */
export function unrenderDOM(div) {
    const divElement= isString(div) ? document.getElementById(div) : div;
    ReactDOM.unmountComponentAtNode(divElement);
}



/* LZ the description field below appeared twice when it is added to the jsdoc.
 * @description Add a listener to any action type
 * */
/**
 * @param {string} actionType a string or and array of strings. Each string is an action constant from firefly.action.type
 * @param {function} callBack the call back will be call with two parameters: action object and state object
 *                 If it returns true the listener will be removed.
 * @return {function} a function that will remove the listener
 */
export function addActionListener(actionType,callBack) {
    var pResolve;
    const cancelPromise= new Promise((resolve) => pResolve= resolve);
    dispatchAddSaga(actionReport,{actionType,callBack, cancelPromise});
    return () => pResolve();
}

//=========================================================================
//------------------ Private ----------------------------------------------
//=========================================================================

/*
 * This saga call a user callback when when one of the actionTypes are dispatched
 * This saga does the following:
 * &lt;ul>
 *     &lt;li>waits until a type in the actionType list is dispatched or a cancel promise
 *     &lt;li>if an action call the callback
 *     &lt;li>if the call back returns true or the cancel promise is resolved then exit
 * &lt;/ul>
 * @param {string | string[]} actionType
 * @param callBack the user callback
 * @param cancelPromise a promise to cancel the callback
 * @param dispatch
 * @param getState a function get the application state
 * 
 */
function *actionReport({actionType,callBack, cancelPromise},dispatch,getState) {
    if (!actionType &amp;&amp; !callBack) return;
    var stopListening= false;
    while (!stopListening) {
        var raceWinner = yield race({
            action: take(actionType),
            cancel: call(() => cancelPromise)
        });
        stopListening= raceWinner.action ? callBack(raceWinner.action,getState()) : true;
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Aug 12 2016 09:34:57 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
