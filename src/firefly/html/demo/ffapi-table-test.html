
<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Demo of Firefly Table</title>

    <style type="text/css">
        label {
            font-weight: bold;
        }
        .input-field {
            padding: 5px;
            margin: 5px;
            background-color: antiquewhite;
            border: 1px solid #9a7f5c;
            display: flex;
            flex-direction: column;        }
        .Tabs {
            background-color: antiquewhite;
            border: 1px solid #9a7f5c;
            margin: 5px 10px;
        }
        button {
            padding: 4px 8px;
        }
        .tabHeader {
            background-color: burlywood;
            padding: 3px;
            border-bottom: 1px solid #9a7f5c;
        }
        .tabContent {
            padding: 5px;
        }
    </style>


    <script type="text/javascript">

        onFireflyLoaded = function (firefly) {
            /*----- setup and place a workspace button at div ID 'WS_input' */
            var onSelect = function (v) {
                document.getElementById("WS_input").value = v;
            }
            firefly.util.renderDOM("WS_popup", firefly.ui.WorkspacePickerPopup,{onComplete: onSelect});
            /*---------------------------------------------------------------*/
        }


        window.onload = function () {
            showTab('General');
        }

        function showTab(tabId) {
            var x = document.getElementsByClassName("tabItem");
            for (var i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            document.getElementById(tabId).style.display = "block";
        }

        function showTable() {
            try {
                var a = document.forms["a"]
                var request;
                if (a.fromWS.value) {
                    request = firefly.util.table.makeIrsaWorkspaceRequest(a.fromWS.value);
                } else if (a.wise.checked) {
                    request = firefly.util.table.makeIrsaCatalogRequest('allwise_p3as_psd', 'WISE', 'allwise_p3as_psd',
                            {
                                position: '148.9;68.8;EQ_J2000',
                                SearchMethod: 'Cone',
                                radius: 300
                            });
                } else {
                    request = firefly.util.table.makeFileRequest(null, a.url.value, null,
                            {META_INFO: {CENTER_COLUMN: 'crval1;crval2;EQJ2000'}});
                }

                var params = {};
                if (a.params.value.trim()) {
                    params = JSON.parse(a.params.value);
                    Object.assign(request, params);
                }
                var options = {};
                if (a.options.value.trim()) {
                    options = JSON.parse(a.options.value);
                }
                if (a["meta-info"].value.trim()) {
                    var META_INFO = JSON.parse(a["meta-info"].value);
                    Object.assign(request.META_INFO, META_INFO);
                }

                firefly.showTable('table-display', request, options);
            } catch (e) {
                alert(e);
            }
        }
    </script>

    <script  type="text/javascript" src="../firefly_loader.js"></script>

</head>

<body>

<div id= "fireflyLostConnWarn" data-decor="full" class="warning-div center"></div>


<h3>  Table Test </h3>
<div style="display:inline-flex">
    <div>
        <form name="a">
            <div class="input-field">
                <div style="margin-bottom: 10px"><b>Load table from first available source</b></div>
                <div>
                    <div id="WS_popup"></div>
                    <input id="WS_input" name="fromWS" type="hidden"/>
                </div>
                <label> Use WISE catalog:
                    <input name="wise" type="checkbox" checked/>
                </label>
                <label> URL:
                    <input name="url" value="http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl" size=60/>
                </label>
            </div>

            <div class="input-field">
                <label> Params</label>
                <textarea id="params" name="params" rows="5" cols="70">{"sortInfo": "ASC,clon"}</textarea>
            </div>

            <div class="input-field">
                <label> META_INFO</label>
                <textarea id="meta-info" name="meta-info" rows="5" cols="70">{"col.clon.PrefWidth": 100}</textarea>
            </div>

            <div class="input-field">
                <label> Options:</label>
                <textarea name="options" rows="5" cols="70">{"pageSize": 100}</textarea>
            </div>

        </form>
        <div class="input-field">
            <button style="width: 100px" onclick="showTable()">Show Table</button>
        </div>
    </div>

    <div class="Tabs">
        <div class="tabHeader">
            <button class="tabButton" onclick="showTab('ParamInfo')">ParamInfo</button>
            <button class="tabButton" onclick="showTab('META_INFO')">META_INFO</button>
            <button class="tabButton" onclick="showTab('TblOptions')">TblOptions</button>
        </div>
        <div class="tabContent">

            <div id="General" class="tabItem">
                <h3>How to use these input fields</h3>
                <pre>
These input fields are in JSON string format.  Remember to enclosed property and string values in double-quotes.
Backslash '\' can be used to escape double-quotes.

There are additional information specific to each input field.  Click the top buttons to navigate to them.
                </pre>
            </div>

            <div id="TblOptions" class="tabItem">
                <h3>TblOptions</h3>
                <pre>
* @typedef {object} TblOptions
* @prop {string}  [tbl_group]    the group this table belongs to.  Defaults to 'main'.
* @prop {boolean} [backgroundable=false]    true if this search can be sent to background.  Defaults to false.
* @prop {string}  [title]        title of this table.
* @prop {boolean} [setAsActive=true]  make this the active table once it's added to the UI.
* @prop {number}  [pageSize]     the starting page size.  Will use the request's pageSize if not given.
* @prop {boolean} [selectable=true]
* @prop {boolean} [expandable=true]
* @prop {boolean} [removable=true]  true if this table can be removed from view.
* @prop {boolean} [border=true]
* @prop {boolean} [showUnits=true]
* @prop {boolean} [showFilters=false]
* @prop {boolean} [showToolbar=true]
* @prop {boolean} [showTitle=true]
* @prop {boolean} [showPaging=true]
* @prop {boolean} [showSave=true]
* @prop {boolean} [showOptionButton=true]
* @prop {boolean} [showFilterButton=true]
* @prop {boolean} [showInfoButton=false]
* @prop {function[]}  [leftButtons]   an array of functions that returns a button-like component laid out on the left side of this table header.
* @prop {function[]}  [rightButtons]  an array of functions that returns a button-like component laid out on the right side of this table header.
                </pre>
            </div>

            <div id="META_INFO"  class="tabItem">
                <h3>META_INFO</h3>
                <pre>
Anything set in META_INFO will go into the resulting table as tableMeta.

Column property can be set via META_INFO as well.  However, there's a discrepancy between the JS and Java constants.
This will be resolved in the near future.  These exposed properties should mirrored java code: edu.caltech.ipac.table.IpacTableUtil.consumeColumnInfo
Use format:  col.[col-name].[col-prop]

[col-prop] : java -> javascript
Label               * @prop {string} label      display name of the column
Visibility          * @prop {string} visibility show, hide, or hidden.  hidden columns are not viewable by users.
Width               * @prop {number} width      max width needed to display data.
PrefWidth           * @prop {number} prefWidth  preferred width, regardless of the data.
Desc                * @prop {string} desc       description of the column
ShortDescription    * @prop {string} desc       description of the column        // @deprecated, for backward compatibility only
NullStr             * @prop {string} nullString string used to represent null value
Unit                * @prop {string} units      data units
Format              * @prop {string} format     a java format to be applied to the value.  This can applies to any data type.
FmtDisp             * @prop {string} fmtDisp    alias to Format.                // @deprecated, for backward compatibility only
Sortable            * @prop {boolean} sortable  true if undefined
Filterable          * @prop {boolean} filterable true if undefined
SortByCols          * @prop {string} sortByCols column to be sorted by.  values are separted by comma(',')
EnumVals            * @prop {string} enumVals   contains only values in this list.  values are seprated by comma(',')
Precision           * @prop {string} precision applies only to floating point numbers.
                                               A string Tn where T is either F, E, or G
                                               If T is not present, it defaults to F.
                                               When T is F or E, n is the number of significant figures after the decimal point.
                                               When T is G, n is the number of significant digits
UCD                 * @prop {string} UCD       UCD of this column.
UType               * @prop {string} utype     UType of this column.
Ref                 * @prop {string} ref       refer to this column for declarations.
MinValue            * @prop {string} minValue  minimum value.
MaxValue            * @prop {string} maxValue  maximum value.
Links               * @prop {string} links     array of LINK if any
Value               * @prop {string} value     static value of this column for all of the rows in this table

                </pre>
            </div>

            <div id="ParamInfo"  class="tabItem">
                <h3>ParamInfo</h3>
                <pre>
Beside query paremters, you can also set these parameters to farther constraint the results.
** Remember, column name must be enclosed in double-quotes.  You may use sql expressions in these properties as well.

* @prop {string} filters   list of conditions separted by comma(,). Format:  (col_name|index) operator value.
*                  operator is one of '> < = ! >= <= IN'.  See DataGroupQueryStatement.java doc for more details.
* @prop {string} sortInfo  sort information.  Format:  (ASC|DESC),col_name[,col_name]*
* @prop {string} inclCols  list of columns to select.  Column names separted by comma(,)
                </pre>
            </div>
        </div>
    </div>
</div>


<div id="table-display" style="margin: 5px; width: 1200px; height: 600px;"/>

<div id = "fireflyLostConnWarn-right" data-decor="medium" class="warning-div right"></div>
<div id ="fireflyLostConnWarn-left" data-decor="medium" class="warning-div left"></div>

<div id ="fireflyLostConnWarn-custom" data-decor="small" class="warning-div" style="margin-left: 75px; background-color: greenyellow"></div>


