<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Charts in Firefly</title>
</head>

<body>


<div style="width: 500px; padding: 50px 0 0 20px;">
    <h2>
    Chart API Demo
    </h2>
</div>

<div id="histogramHere" style="width: 800px; height: 550px; border: solid 1px"></div>
<br/><br/>
<div id="xyplotHere" style="width: 800px; height: 550px; border: solid 1px;"></div>

<h3>Histogram with JSON data from a Python task</h3>
<div id="jsonDataHistogram" style="width: 800px; height: 350px; border: solid 1px;"></div>


<script type="text/javascript">
    {
        onFireflyLoaded= function(firefly) {

            // show histogram data  no options, no connection to the table)
            // data is an array of rows,
            // first col - nPoints or number of points in the bin, second col - binMin, third col - binMax
            // (supports variable length bins)
            // define overlapping histograms in series array
            const props = {
                series: [
                    {data : [
                        [1,1,10],
                        [10,10,100],
                        [100,100,1000],
                        [1000,1000,10000],
                        [100,10000,100000],
                        [10,100000,1000000],
                        [1,1000000,10000000]],
                        binColor:'#336699',
                        name:'sample1'},
                    {data : [
                        [6, 50,150],
                        [80,150,1200],
                        [15,1200,30400]],
                        binColor:'#CB3515',
                        name:'sample2'}
                ],
                width: 800,
                height: 550,
                logs: 'xy',
                desc: 'Both X and Y are using log scale'
            };

            /**
             // one histogram
             const props = {
                data : [
                 [1,1,10],
                 [10,10,100],
                 [100,100,1000],
                 [1000,1000,10000],
                 [100,10000,100000],
                 [10,100000,1000000],
                 [1,1000000,10000000]
                 ],
                width: 800,
                height: 550,
                logs: 'xy',
                desc: 'Both X and Y are using log scale',
                binColor: '#336699'
             };
             **/
            firefly.util.renderDOM('histogramHere', firefly.ui.Histogram, props);

            // show scatter chart
            firefly.debug= true;
            chartParams = {
                source: 'http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl',
                xCol: 'ra1',
                yCol: 'dec1'
            };
            firefly.showXYPlot('xyplotHere', chartParams);

            // show histogram, generated by firefly/python/SamplePythonLauncher.py
            // check console for errors, if it does not show up
            var launcher = 'python';
            var task = 'JsonTaskToGetHistogramData';
            var bins = 25;

            var taskParams = {'numbins': bins};
            firefly.getJsonFromTask(launcher, task, taskParams)
                    .then(function (histdata) {
                                console.log('Returned JSON: ' + JSON.stringify(histdata));
                                firefly.util.renderDOM("jsonDataHistogram", firefly.ui.Histogram,
                                        {
                                            'descr': 'Histogram data returned from python JSON task',
                                            'binColor': '#3d3033',
                                            'height': 350,
                                            'data': histdata
                                        });

                            }
                    ).catch(function (reason) {
                        console.error('Error fetching JSON data from ' + launcher + ' task ' + task + ': ' + reason);
                        document.getElementById('jsonDataHistogram').innerHTML = '<p style="color:red">'+reason+'</p>';
                    }
            );

        }
    }


</script>


<script  type="text/javascript" src="../firefly_loader.js"></script>


</body>
</html>