<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Charts in Firefly</title>
</head>

<body>


<div style="width: 500px; padding: 50px 0 0 20px;">
    <h2>
    Chart API Demo
    </h2>
</div>

<div id="table-lg" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="heatmapHere" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="histogramHere" style="width: 800px; height: 550px; border: solid 1px"></div>
<br/><br/>
<div id="xyplotHere" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="plotly" style="resize: both; overflow: auto; padding: 5px; width: 800px; height: 550px; border: solid 1px gray;"></div>
<br/><br/>
<div id="table-1" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>

<script type="text/javascript">
    if (!window.firefly) window.firefly= {};
    window.firefly.options= {charts: {chartEngine: 'plotly'}};
</script>

<script type="text/javascript">
    {
        onFireflyLoaded= function(firefly) {

//            // show histogram data  no options, no connection to the table)
//            // data is an array of rows,
//            // first col - nPoints or number of points in the bin, second col - binMin, third col - binMax
//            // (supports variable length bins)
//            // define overlapping histograms in series array
//            const props = {
//                series: [
//                    {data : [
//                        [1,1,10],
//                        [10,10,100],
//                        [100,100,1000],
//                        [1000,1000,10000],
//                        [100,10000,100000],
//                        [10,100000,1000000],
//                        [1,1000000,10000000]],
//                        binColor:'#336699',
//                        name:'sample1'},
//                    {data : [
//                        [6, 50,150],
//                        [80,150,1200],
//                        [15,1200,30400]],
//                        binColor:'#CB3515',
//                        name:'sample2'}
//                ],
//                width: 800,
//                height: 550,
//                logs: 'xy',
//                desc: 'Both X and Y are using log scale'
//            };
//
//            /**
//             // one histogram
//             const props = {
//                data : [
//                 [1,1,10],
//                 [10,10,100],
//                 [100,100,1000],
//                 [1000,1000,10000],
//                 [100,10000,100000],
//                 [10,100000,1000000],
//                 [1,1000000,10000000]
//                 ],
//                width: 800,
//                height: 550,
//                logs: 'xy',
//                desc: 'Both X and Y are using log scale',
//                binColor: '#336699'
//             };
//             **/
//            firefly.util.renderDOM('histogramHere', firefly.ui.Histogram, props);

            var dataH = [
                {name: 'dec-0.02', marker: {color: 'rgba(153, 51, 153, 0.8)'}},
                {name: 'dec+0.02', marker: {color: 'rgba(102,153,0, 0.7)'}}
            ];

            var fireflyDataH = [
                {
                    dataType: 'fireflyHistogram',
                    tbl_id: 'test-tbl',
                    options: {
                        algorithm: 'fixedSizeBins',
                        fixedBinSizeSelection: 'numBins',
                        numBins: 30,
                        columnOrExpr: 'dec-0.02'
                    }
                },
                {
                    dataType: 'fireflyHistogram',
                    tbl_id: 'test-tbl',
                    options: {
                        algorithm: 'fixedSizeBins',
                        fixedBinSizeSelection: 'numBins',
                        numBins: 40,
                        columnOrExpr: 'dec+0.02'   // same column but shifted
                    }
                }
            ];
            firefly.showPlot('histogramHere', {chartId: 'firefly-hist-tbl', chartType: 'plot.ly', data: dataH, fireflyData: fireflyDataH});


            // show scatter chart
            firefly.debug= true;
            chartParams = {
                source: 'http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl',
                xCol: 'ra1',
                yCol: 'dec1'
            };
            firefly.showXYPlot('xyplotHere', chartParams);


            var trace1 = {
                x: [1, 2, 3, 4],
                y: [10, 15, 13, 17],
                mode: 'markers',
                type: 'scatter'
            };

            var trace2 = {
                x: [2, 3, 4, 5],
                y: [16, 5, 11, 9],
                mode: 'lines',
                type: 'scatter'
            };

            var data = [trace1, trace2];
            firefly.showPlot('plotly', {chartId: 'test', chartType: 'plot.ly', data: data});


            var tblReq =  firefly.util.table.makeIrsaCatalogRequest('allwise_p3as_psd', 'WISE', 'allwise_p3as_psd',
                    {   position: '10.68479;41.26906;EQ_J2000',
                        SearchMethod: 'Cone',
                        radius: 300
                    },
//                    {   position: '202.48;47.23;EQ_J2000',
//                        SearchMethod: 'Cone',
//                        radius: 30,
//                    },
                    {tbl_id: 'test-tbl'});
            firefly.showTable('table-1', tblReq);

            trace1 = {
                x: "tables::test-tbl,ra",
                y: "tables::test-tbl,dec",
                mode: 'markers',
                type: 'scatter'
            };

            firefly.showPlot('plotly', {chartId: 'plotly-tbl', chartType: 'plot.ly', data: [trace1], fireflyData: [{dataType: 'fireflyScatter'}]});


            var tblReqLg =  firefly.util.table.makeIrsaCatalogRequest('allwise_p3as_psd', 'WISE', 'allwise_p3as_psd',
                    {   position: '10.68479;41.26906;EQ_J2000',
                        SearchMethod: 'Cone',
                        radius: 1200
                    },
                    {tbl_id: 'test-tbl-lg'});
            firefly.showTable('table-lg', tblReqLg);

            var dataHM = [
                {
                    type: 'heatmap',
                    name: 'w1-w2',
                    x: "tables::test-tbl-lg,w1mpro",
                    y: "tables::test-tbl-lg,w2mpro",
                    colorscale: 'Blues'
                },
                {
                    type: 'heatmap',
                    name: 'w1-w3',
                    x: "tables::test-tbl-lg,w1mpro",
                    y: "tables::test-tbl-lg,w3mpro",
                    colorscale: 'Reds',
                    reversescale: true
                },
                {
                    type: 'heatmap',
                    name: 'w1-w4',
                    x: "tables::test-tbl-lg,w1mpro",
                    y: "tables::test-tbl-lg,w4mpro",
                    colorscale: 'Greens'
                }
            ];
            var	fireflyDataHM = [
                {dataType: 'fireflyHeatmap'},
                {dataType: 'fireflyHeatmap'},
                {dataType: 'fireflyHeatmap'}
            ];

            firefly.showPlot('heatmapHere', {chartId: 'plotly-tbl-lg', chartType: 'plot.ly', data: dataHM, fireflyData: fireflyDataHM});

        }
    }


</script>


<script  type="text/javascript" src="../firefly_loader.js"></script>


</body>
</html>