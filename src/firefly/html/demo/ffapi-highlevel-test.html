<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Demo of Firefly Tools</title>
</head>

<body>


<div style="width: 500px; padding: 50px 0 0 20px;">
    <br>
    This page demos new api
    <br>
</div>

<div>
    <!--<a href='javascript:firefly.getViewer("testChannel").showImage({url:"http://web.ipac.caltech.edu/staff/roby/demo/wise-m51-band2.fits"})'>test open</a>-->
    <a href='javascript:firefly.getViewer().plotURL("http://web.ipac.caltech.edu/staff/roby/demo/wise-m51-band2.fits")'>test open</a>
    <a href="javascript:plotRemote()">test again</a>
    <a href="javascript:firefly.getViewer().showImage(window.threeC)">3 C</a>
    <a href="javascript:firefly.action.dispatchZoom({plotId: 'xxq',userZoomType:'UP' ,dispatcher:window.ffViewer.dispatch})">up</a>
    <a href="javascript:firefly.action.dispatchZoom({plotId: 'xxq',userZoomType:'DOWN' ,dispatcher:window.ffViewer.dispatch})">down</a>
</div>
<div>
    <a href='../../firefly/;a=ImagePlotCntlr.PlotImage?wpRequest={%20%22File%22:%20%22http://ned.ipac.caltech.edu/img/1988MNRAS.230..345N/ARP_220:I:6cm:n1988.fits.gz%22,%20%22URL%22:%20%22http://ned.ipac.caltech.edu/img/1988MNRAS.230..345N/ARP_220:I:6cm:n1988.fits.gz%22,%20%22RangeValues%22:%20%2292,-2,92,8,1,0,1,2,44,25,600,120%22,%20%22PostTitle%22:%20%22ARP%20220%22,%20%22TitleFilenameModePfx%22:%20%22cutout%22,%20%22ColorTable%22:%201,%20%22TitleOptions%22:%20%22FILE_NAME%22,%20%22Type%22:%20%22TRY_FILE_THEN_URL%22%20}'>Show Fits by URL</a>
</div>
<div>
    <a href="javascript:loadMoving()">load Moving Images</a>
</div>
<div>
    <a href="javascript:loadMovingTable()">load Moving Table</a>
</div>
<div>
    <a href="javascript:loadSimpleImageTable()">load image Table</a>
</div>
<div>
    <a href="javascript:loadSimpleM31ImageTable()">load m31 image Table</a>
</div>
<div>
    <div id="imageViewHere" style="display: inline-block; width: 550px; height: 550px; margin: 10px;"></div>
    <div id="coverageHere" style="display: inline-block; width: 400px; height: 400px; margin: 10px;"></div>
</div>
<div id="hipsHere" style="width: 550px; height: 550px; margin: 10px;">
</div>
<!--<div>-->
    <!--<div id="movingDiv" style="display: inline-block; width: 400px; height: 400px; margin: 10px;"></div>-->
<!--</div>-->
<div>Tables from API calls:
    <a href='javascript:firefly.getViewer().showTable(tblReq3)'>Open a table</a>
    <a href='javascript:firefly.getViewer().showTable(tblReq1)'>Open allwise</a>
    <a href='javascript:tblReq1.sortInfo="ASC,ra"; firefly.getViewer().fetchTable(tblReq1)'>Sort allwise by ra</a>
    <a href='javascript:launchTimeSeries()'>Launch Time Series</a>
    <a href='javascript:firefly.getViewer(null, "ts.html").showTable(firefly.util.table.makeFileRequest(null, "http://web.ipac.caltech.edu/staff/ejoliet/demo/WISE-mep-2764p772_ac51-010204.tbl",null,{ tbl_id: "raw_table",META_INFO: {TSDatasetId: "wise"} }))'>Launch TS</a>
    <div style="display: inline-flex; background-color: white">
        <div id="tables-2" style="width: 550px; height: 300px; margin: 10px"></div>
        <div id="tables-1" style="width: 550px; height: 300px; margin: 10px"></div>
        <div>
            <div style="font-size: small">show getSelectedData API call to 2nd table of 2nd tablpanel ('http://web.ip....')</div>
            <input type="button" value="show selected" onclick="javascript:loadSelectRows()">
            <div id="selectedRows" style="height: 275px; overflow: auto"></div>
        </div>
    </div>
</div>
<div>XYPlot from API calls:
    <a href='javascript:firefly.getViewer().showXYPlot(xyPlotOpsReq3)'>Show XY Plot</a>&nbsp;&nbsp;&nbsp;
    <a href='javascript:firefly.getViewer().showChart({data:[{x: [1,2,3], y: [1,2,3]}]})'>Show Chart</a>
</div>
<div>
    <div id="xyPlot1" style="display: inline-block; width: 550px; height: 300px; margin: 10px; background-color: white"></div>
    <div id="xyPlot2" style="display: inline-block; width: 550px; height: 300px; margin: 10px; background-color: white; position: absolute"></div>
</div>
<div>XYPlot from API calls:
    <a href='javascript:firefly.getViewer().showHistogram(histogramOpsReq3)'>Show Histogram</a>
</div>
<div>
    <div id="histogram1" style="display: inline-block; width: 550px; height: 300px; margin: 10px; background-color: white"></div>
    <div id="histogram2" style="display: inline-block; width: 550px; height: 300px; margin: 10px; background-color: white; position: absolute"></div>
</div>

<div>
    <div style="display: flex; width:820px">
        <p style="color:blue; margin:3px">Region</p> <p style="color:blue; margin:3px"> Test: </p>
        <p style="margin-top:3px">please enter a region ID or select a region ID first, then click the region operation.
            If there is no region ID entered, the hint shown in the text field is used for "Create Region Layer". </p>
    </div>

    <a href='javascript:createRegionLayer()'>Create Region Layer</a>
    <input type='text' placeholder='' list='regionCreated' id='createRegionId' name='createRegionLayer' onChange='updateDatalist()'>
    <datalist id='regionCreated'>
    </datalist>
    lolor: <input type='text' id='selectColor' value='#DAA520' style="width: 60px">
    lineWidth: <input type='text' id='lineWidth' value='0' style="width: 30px">
    <select id='selectStyle'>
        <option value='UprightBox'>Upright box</option>
        <option value='DottedOverlay'>Overlay with dotted border</option>
        <option value='SolidOverlay'>Overlay with differet color</option>
        <option value='DottedReplace'>Replace with dotted border</option>
        <option value='SolidReplace'>Replace with differnt color</option>
    </select>
    <a href='javascript:deleteRegionLayer()'>Delete Region Layer</a>
    <select id='regionList_delete'><option selected disabled>Region Layer:</option></select>
    <div>
        <textarea id="regionLayerContent" style="width: 800px; height: 300px; margin: 10px;"> </textarea>
    </div>
</div>
<div>
    <a href='javascript:addRegionEntry()'>Add Region Entry </a>
    <select id='regionEntry_add'><option selected disabled>Region Layers:</option></select>
    <a href='javascript:removeRegionEntry()'>Remove Region Entry</a>
    <select id='regionEntry_remove'><option selected disabled>Regiion Layers:</option></select>
    <div>
        <textarea id="moreRegionContent" style="width: 800px; height: 300px; margin: 10px;"> </textarea>
    </div>
    <a href='javascript:selectRegion()'>Select the following region(s):</a>
    <select id='regionEntry_select'><option selected disabled>Region Layers:</option></select>
    <div>
        <textarea id='selectRegionContent' style='width: 800px; height: 300px; margin: 10px;'></textarea>
    </div>
</div>

<script type="text/javascript">
    if (!window.firefly) window.firefly= {};
    window.firefly.options= {charts: {}};
</script>


<script type="text/javascript">
    {
        function loadMoving() {
            var m49025b_143_2= {
                url: 'http://web.ipac.caltech.edu/staff/roby/demo/moving/49025b143-w2-int-1b.fits',
                plotId: 'm49025b_143_2',
                OverlayPosition : '330.347003;-2.774482;EQ_J2000',
                ZoomType : 'TO_WIDTH_HEIGHT',
                Title: '49025b143-w2',
                plotGroupId : 'movingGroup',
            };
            var m49273b_134_2= {
                url: 'http://web.ipac.caltech.edu/staff/roby/demo/moving/49273b134-w2-int-1b.fits',
                plotId: 'm49273b_134_2',
                OverlayPosition : '333.539702;-0.779310;EQ_J2000',
                ZoomType : 'TO_WIDTH_HEIGHT',
                Title: '49273b134-w2',
                plotGroupId : 'movingGroup',
            };
            var m49277b_135_1= {
                url: 'http://web.ipac.caltech.edu/staff/roby/demo/moving/49277b135-w1-int-1b.fits',
                plotId: 'm49277b_135_1',
                OverlayPosition : '333.589054;-0.747251;EQ_J2000',
                ZoomType : 'TO_WIDTH_HEIGHT',
                Title: '49277b135-w1',
                plotGroupId : 'movingGroup',
            };
            var m49289b_134_2= {
                url: 'http://web.ipac.caltech.edu/staff/roby/demo/moving/49289b134-w2-int-1b.fits',
                plotId: 'm49289b_134_2',
                OverlayPosition : '333.736578;-0.651222;EQ_J2000',
                ZoomType : 'TO_WIDTH_HEIGHT',
                Title: '49289b134-w2',
                plotGroupId : 'movingGroup',
            };

//            firefly.showImage('movingDiv', m49025b_143_2);
//            firefly.showImage('movingDiv', m49273b_134_2);
//            firefly.showImage('movingDiv', m49277b_135_1);
//            firefly.showImage('movingDiv', m49289b_134_2);

            firefly.getViewer().showImage( m49025b_143_2);
            firefly.getViewer().showImage( m49273b_134_2);
            firefly.getViewer().showImage( m49277b_135_1);
            firefly.getViewer().showImage( m49289b_134_2);
        }
    }
</script>

<script type="text/javascript">
    {
        function loadSelectRows() {
            firefly.util.table.getSelectedData(tblReq3.tbl_id, ['crval1', 'crval2'])
                    .then( function (tableModel) {
                        var rowCnt = tableModel.totalRows;
                        var cell = firefly.util.table.getCellValue;
                        var cnames = firefly.util.table.getColumns(tableModel).map(function (c) {return c.name});

                        var txt = "<table border='1'><tr>"
                        cnames.forEach( function(col) {
                            txt += "<td>" + col + "</td>";
                        });
                        txt += "</tr>";
                        for (var idx =0; idx < rowCnt; idx++) {
                            txt += "<tr>";
                            cnames.forEach( function(col) {
                                txt += "<td>" + cell(tableModel, idx, col) + "</td>";
                            });
                            txt += "</tr>";
                        }
                        txt += "</table>"
                        document.getElementById("selectedRows").innerHTML = txt;
                    });
        }

        function launchTimeSeries(req) {
            var req = firefly.util.table.makeFileRequest(null, 'http://web.ipac.caltech.edu/staff/ejoliet/demo/WISE-mep-2764p772_ac51-010204.tbl',null,
                    { tbl_id: 'raw_table',
                      META_INFO: {TSDatasetId: 'wise'} });
            firefly.getViewer(null, "ts.html").showTable(req);

        }

        function loadMovingTable() {
            var req = firefly.util.table.makeFileRequest('A moving object table',
                    'http://web.ipac.caltech.edu/staff/roby/demo/moving/MOST_results-sample.tbl',null,
                    { pageSize: 15,
                        META_INFO: {
                            datasetInfoConverterId : 'SimpleMoving',
                            positionCoordColumns: 'ra_obj;dec_obj;EQ_J2000',
                            datasource: 'image_url'
                        }
                    });
            firefly.getViewer().showTable( req, {removable: true, showUnits: false, showFilters: true});
        }

        function loadSimpleImageTable() {
            var req = firefly.util.table.makeFileRequest('A table of images',
                    'http://web.ipac.caltech.edu/staff/roby/demo/test-table4.tbl',null,
                    { pageSize: 15,
                        META_INFO: {
                            datasource: 'FITS'
                        }
                    });
            firefly.getViewer().showTable( req, {removable: true, showUnits: false, showFilters: true});
        }
        function loadSimpleM31ImageTable() {
            var req = firefly.util.table.makeFileRequest('A table of images',
                    'http://web.ipac.caltech.edu/staff/roby/demo/test-table-m31.tbl',null,
                    { pageSize: 15,
                        META_INFO: {
                            positionCoordColumns: 'ra_obj;dec_obj;EQ_J2000',
                            datasource: 'FITS'
                        }
                    });
            firefly.getViewer().showTable( req, {removable: true, showUnits: false, showFilters: true});
        }
    }
</script>




<script type="text/javascript">
    {
        onFireflyLoaded= function(firefly) {

            window.ffViewer= firefly.getViewer();

            firefly.setGlobalImageDef({
                ZoomType  : 'TO_WIDTH'
            } );

            firefly.debug= true;

            var util= firefly.util;
            var ui= firefly.ui;
            // ----------------- to use minimal readout, do the following
            //  util.image.initAutoReadout(ui.DefaultApiReadout,
            //         {MouseReadoutComponent:ui.PopupMouseReadoutMinimal, showThumb:false,showMag:false});
            // -----------------

            var req= {
                plotId: 'xxq',
                Type      : 'SERVICE',
                plotGroupId : 'myGroup',
                Service   : 'TWOMASS',
                Title     : '2mass from service',
                ColorTable : 5,
                GridOn     : true,
//                GridOn     : 'TRUE_LABELS_FALSE',
                SurveyKey  : 'k',
                WorldPt    : '10.68479;41.26906;EQ_J2000',
                SizeInDeg  : '.12',
                AllowImageSelection : true
            };

            var req2= {
                Type      : 'SERVICE',
                plotGroupId : 'myGroup',
                Service  : 'WISE',
                Title     : 'Wise',
                GridOn     : true,
//                GridOn     : 'TRUE_LABELS_FALSE',
                SurveyKey  : 'Atlas',
                bad1  : 'hello',
                bad2  : 'bye',
                bad3  : 'again',
                SurveyKeyBand  : '2',
                WorldPt    : '10.68479;41.26906;EQ_J2000',
                SizeInDeg  : '.12',
                RangeValues : firefly.util.image.RangeValues.serializeSimple('Sigma',-2,8,'Linear'),
                AllowImageSelection : true };



            window.threeC= [
                {
                    type      : 'SERVICE',
//                    plotGroupId : 'myGroup',
                    Service   : 'TWOMASS',
                    Title     : '3 color',
                    SurveyKey  : 'j',
                    WorldPt    : '10.68479;41.26906;EQ_J2000',
                    SizeInDeg  : '.12'
                },
                {
                    Type      : 'SERVICE',
//                    PLOTgroupId : 'myGroup',
                    Service   : 'TWOMASS',
                    Title     : '3 color',
                    SurveyKey  : 'h',
                    WorldPt    : '10.68479;41.26906;EQ_J2000',
                    SizeInDeg  : '.12'
                },
                {
                    Type      : 'SERVICE',
//                    plotGroupId : 'myGroup',
                    Service   : 'TWOMASS',
                    title     : '3 color',
                    SurveyKey  : 'k',
                    WorldPt    : '10.68479;41.26906;EQ_J2000',
                    moreBadKeys : 'qqq',
                    SizeInDeg  : '.12'
                }
            ];

            //util.image.setDrawLayerDefaults('ACTIVE_TARGET_TYPE', {symbol:'x', color:'pINk'});
            //util.image.setDrawLayerDefaults('CATALOG_TYPE', {symbol:'ARROW', color:'pink', size:10});

            firefly.showImage('imageViewHere', req);
            firefly.showImage('imageViewHere', req2);
            firefly.showImage('imageViewHere', window.threeC);
            firefly.showImage('imageViewHere', {url:'http://web.ipac.caltech.edu/staff/roby/demo/wise-m51-band2.fits', plotId: 'regiontest'});
//
            firefly.showImage('imageViewHere', {
                url:'http://bacchus1.ipac.caltech.edu:9070/cgi-bin/Subimage/nph-subimage?origfile=/irsadata/COSMOS//images%2Facs_2.0%2FI%2Facs_I_095921%2B0228_unrot_wht_20.fits&ra=149.858180&dec=2.479260&xsize=0.200000',
                plotId: 'badURLTest',
                title     : 'Failure Test',
            });
            firefly.showImage('imageViewHere', {
                //file : '/external/wise-m31-level1-3.fits',
                //url : 'file:///Users/roby/fits/wise-m31-level1-3.fits',
                url : 'FILE:///Users/roby/fits/dss-m31.fits',
                //url : 'file:///Users/roby/fits/dss-m31-red.fits',
//                url : 'file:///Users/roby/fits/f-32.fits',
                title     : 'From a Container',
            });

            firefly.showCoverage('coverageHere', {gridOn:true});

            firefly.showHiPS('hipsHere',
                {
                    plotId: 'aHipsID',
                    WorldPt : '148.9;68.8;EQ_J2000',
                    title     : 'A HiPS',
                    hipsRootUrl: 'http://alasky.u-strasbg.fr/DSS/DSSColor'
                }
            );


            //-----------------  TABLE DEMO ------------------------//
            tblReq1 = firefly.util.table.makeIrsaCatalogRequest('allwise_p3as_psd', 'WISE', 'allwise_p3as_psd',
                    {   position: '148.9;68.8;EQ_J2000',
                        SearchMethod: 'Cone',
                        radius: 300
                    });
            tblReq2 = firefly.util.table.makeIrsaCatalogRequest('another wise catalog', 'WISE', 'allwise_p3as_psd',
                    {   position: '10.68479;41.26906;EQ_J2000',
                        SearchMethod: 'Cone',
                        radius: 300
                    });
            tblReq3 = firefly.util.table.makeFileRequest(null, 'http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl',null,
                    { pageSize: 15,
                        META_INFO: {CENTER_COLUMN: 'crval1;crval2;EQJ2000'}
                    });


            firefly.showTable('tables-1', tblReq1);
            firefly.showTable('tables-1', tblReq3);
            firefly.showTable('tables-2', tblReq2, {removable: false, showUnits: true, showFilters: true});
            //-----------------  CHART DEMO ------------------------//
            //--- using QUERY_ID: 'upload' does not work getActiveTableId('upload') returns undefined ---//
            xyPlotOpsReq3 = {source: 'http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl', xCol: 'ra1', yCol: 'dec1'};
            firefly.showXYPlot('xyPlot1', {tbl_id: tblReq2.tbl_id, xCol: 'ra', yCol: 'dec', help_id: 'visualization.xyplotViewer'});
            firefly.showXYPlot('xyPlot2', {tbl_id: tblReq2.tbl_id, xCol: 'w1mpro+w4mpro', yCol: 'w2mpro'});
            histogramOpsReq3 = {source: 'http://web.ipac.caltech.edu/staff/roby/demo/WiseDemoTable.tbl', col: 'modeint', xOptions: 'log'};
            firefly.showHistogram('histogram1', {tbl_id: tblReq2.tbl_id, col: 'w1mpro'});
            firefly.showHistogram('histogram2', {tbl_id: tblReq2.tbl_id, col: 'w2mpro+w3mpro', falsePositiveRate: 0.05});




            window.regionAry = [
                 /*
                'global color=green dashlist=8 3 width=1 font="helvetica 10 normal normal" select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 rotate=0 source=1',
                'J2000;point    202.41   47.262 # color=pink text="pt circle 1" point=circle',
                'box (100p, 70p, 20p, 20p, 0) #color=red text={Physical coordinate - 1}',
                'box (100i, 70i, 30i, 30i, 0) #color=orange text={Image coordinate -2}',
                'line(202.414796 47.281999 202.423758 47.247072) # color=orange width=10 select=0 text={line 2}',
                'text 30p 40p # color=pink text={text test 3} edit=0 highlite=0 font="BRAGGADOCIO 10 normal roman"',
                'text 202.437691 47.234228{more text testing 4} # color=purple move=0',
                'point    202.43    47.270 # point=x 15 color=green text="pt x 5" rotate=0',
                '#point    202.45    47.262 # color=red 10p text="pt boxcircle 6" delete=0 point=boxcircle 10',
                'boxcircle point    202.45    47.262 # color=red text="pt boxcircle 6" delete=0',
                'physical;circle   80 140  20       # color=red offsetx=25  offsety=2 width=5 edit=0 text="circle 7"',
                'annulus   13h30m16.41s +47d14m43.9s  30p 40p 50p       # color=green text="hello" include=0 text="annulus 8"',
                'physical;point 200 140 # color=yellow point=cross 20 text="pt cross 9" offsetx=10',
                'physical;point 13h29m52.73s, +47d11m40.9s # color=purple point=diamond 15 text="pt diamond 10"',
                '#circle(202.55556, 47.188286 , 20p)  # color=blue text="text 11"',
                'box(202.55556, 47.188286 ,20p,40p, 30p, 50p, 0)  # color=red width=5 text="boxann 11"',
                'box(202.52556,47.226286,0.0240,0.006,0)  # color=green width=5 text="box 11-2"',
                'image;box(100, 150, 50p, 20p, 2r) # color=magenta width=6 text="slanted box 12"',
                'image;box(190.564796, 47.281999, 50p, 20p, 0) # color=red width=6 offsety=-15 text="box 12-1"',
                'j2000;box(47.247072i, 180.445347i, 50p, 20p, 0) # color=blue width=6 text="box 12-3"',
                'physical;-box point 12 12 # text="pt box 13"',
                'j2000;polygon(202.564796, 47.281999,202.553758, 47.247072, 202.445347, 47.244296, 202.479687, 47.264027, 202.492153, 47.290841) # color=blue text="polygon 14" offsety=10 width=10 font="helvetica 16 bold"',
                'point    202.45   47.2879 # color=cyan text="pt arrow 15" delete=0 point=arrow 20',
                'IMAGE;box (160, 70, 20, 20, 0) #color=red text={IMAGE test - 1}',
                'PHYSICAL;box (160, 70, 30, 30, 0) #color=orange text={PHYSICAL test -2}'
                */
                'box (240, 220, 20, 20, 0) #color=red text={     ph1}',
                'box (240i, 220i, 60i, 60i, 0) #color=orange text={ph2}',
                'J2000;point    202.41   47.262 # color=pink text="pt circle 1" point=circle',
                'IMAGE;box (360, 220, 20, 20, 0) #color=red text={     im1}',
                'PHYSICAL;box (360, 220, 60, 60, 0) #color=orange text={ph3}'
            ];

            window.emptyRegion = '';
            window.regionAry2 = [
                'J2000',
                'boxcircle point    202.45    47.262 # color=red text="pt boxcircle 6" delete=0',
                'physical;circle   80 140  20       # color=red offsetx=25  offsety=2 width=5 edit=0 text="circle 7"',
                'annulus   13h30m16.41s +47d14m43.9s  30p 40p 50p       # color=green text="hello" include=0 text="annulus 8"',
                'physical;point 200 140 # color=yellow point=cross 20 text="pt cross 9" offsetx=10',
                'physical;point 13h29m52.73s, +47d11m40.9s # color=purple point=diamond 15 text="pt diamond 10"',
                '#circle(202.55556, 47.188286 , 20p)  # color=blue text="text 11"',
                'box(202.55556, 47.188286 ,20p,40p, 30p, 50p, 0)  # color=red width=5 text="boxann 11"',
                'box(202.52556,47.226286,0.0240,0.006,0)  # color=green width=5 text="box 11-2"',
                'image;box(100, 150, 50p, 20p, 2r) # color=magenta width=6 text="slanted box 12"',
                'image;box(190.564796, 47.281999, 50p, 20p, 0) # color=red width=6 offsety=-15 text="box 12-1"',
                'j2000;box(47.247072i, 180.445347i, 50p, 20p, 0) # color=blue width=6 text="box 12-3"',
                'physical;-box point 12 12 # text="pt box 13"',
                'j2000;polygon(202.564796, 47.281999,202.553758, 47.247072, 202.445347, 47.244296, 202.479687, 47.264027, 202.492153, 47.290841) # color=blue text="polygon 14" offsety=10 width=10 font="helvetica 16 bold"',
                'point    202.45   47.2879 # color=cyan text="pt arrow 15" delete=0 point=arrow 20'
            ];


            window.smallregion = [
                'J2000;circle  202.4844693750341 47.23118060364845 0.0139268922364868 # color=blue text="circle on J2000"',
            'J2000;annulus 202.4844693750341 47.23118060364845 0.00198268922364868 0.00198268922364868 # color=red text="circle on J2000 with radius 0.00198"',
            'J2000;box 202.4844693750341 47.23118060364845 0.00658268922364868 0.00658268922364868 0 # color=green text="box on J2000"',
            'image;box 50 50 0.00578268922364868 0.00578268922364868 0 # color=yellow text="box on image"'];

            window.regionWithError = [
                'image; box 280 200 72 72 # color=blue text={wrong syntax}',
                'image; box 280 200 72 72 0 # color=cyan text={right syntax}'
            ];

            /*
            window.regionWithSpecialChars = [
                'circle  202.4844693750341 47.23118060364845 13.9268922364868 # color=blue text={j2000 ; circle on ; J2000}',
                'J2000;box 202.4844693750341 47.23118060364845 0.0069268922364 0.0069268922364  0 # color=red text={box on # J2000 with radius ## 0.00198268922364868}',
                'circle  100.4844693750341 147.23118060364845 0.0239268922364868 # color=purple text="j2000 ; circle on # J2000"'
            ];
            */
            window.regionWithSpecialChars = [
                'circle  202.4844693750341 47.23118060364845 13.9268922364868 # color=cyan text={physical;circle ;; color=cyan}',
                'J2000;box 202.4844693750341 47.23118060364845 0.0069268922364 0.0069268922364  0 # color=red text={box on # J2000 with size ## 0.0069268922364}',
                'image;circle  100.4844693750341 147.23118060364845 10.0239268922364868 # color=#B8E986 text="image ; circle # color=#B8E986"'
            ];


            window.moreRegionAry =  [
                'image;ellipse 100 100 20p 40p 30p 60p 40p 80p 20 # color=green text={ellipseannulus 2}',
                'J2000;ellipse 202.55556, 47.188286 20p 40p 0i # color=#48f text={ellipse 1} width=10',
                'image;box 130 100 20p 40p 30p 50p 70p 100p 30 # color=red text={slanted box annulus 3}',
                'j2000;box(47.247072i, 180.445347i, 50p, 20p, 0) # color=cyan width=6 text="box 12-3"'
            ];

            window.regions = [];
            window.regionId = window.regions.length;

            document.getElementById('regionLayerContent').value = window.regionAry.join('\n');
            document.getElementById('moreRegionContent').value = window.moreRegionAry.join('\n');
            document.getElementById('selectRegionContent').value = window.regionAry2[13];
            //document.getElementById('createRegionId').placeholder = "Region_Plot_" + (window.regionId+1);
            updateRegionLayerList();
        };

        createRegionLayer = function() {
            var layerId = document.getElementById('createRegionId').value;

            if (!layerId) {
                window.regionId++;
                layerId = "Region_Plot_" + window.regionId;
                document.getElementById('createRegionId').value = layerId;

            }
            document.getElementById('regionLayerContent').value = window.regionWithSpecialChars.join('\n');

/*
            if (window.regionId === 0) {
                document.getElementById('regionLayerContent').value = window.emptyRegion;
            } else if (window.regionId === 3) {  // region with error
                document.getElementById('regionLayerContent').value = window.regionWithError.join('\n');
            } else if (window.regionId === 1) {  // short region list
                document.getElementById('regionLayerContent').value = window.regionAry.join('\n');
            } else if (window.regionId === 2) {  // short region list for removing all
                document.getElementById('regionLayerContent').value = window.moreRegionAry.join('\n');
            } else if (window.regionId > 3) {    // longer region list
                document.getElementById('regionLayerContent').value = window.regionAry2.join('\n');
            }
*/
            var regionAry = document.getElementById('regionLayerContent').value.split('\n').filter(function(r) { return (r.length !== 0);});
            window.regions.push(layerId);
            updateRegionLayerList();

            var st = document.getElementById('selectStyle').value;
            var lw = parseInt(document.getElementById('lineWidth').value);
            var sc = document.getElementById('selectColor').value;
            var selectMode = {selectStyle: st, selectColor: sc, lineWidth: lw};
            //var selectMode = {selectStyle: style};

            firefly.action.dispatchCreateRegionLayer(layerId, layerId, null, regionAry, 'regiontest', selectMode);
            firefly.action.dispatchCreateRegionLayer(layerId, layerId, null, regionAry, null, selectMode, dispatcher = window.ffViewer.dispatch);
        };

        updateDataList = function() {
            var datalist = document.getElementById('regionCreated');
            var options = '';

            window.regions.forEach( function(r) {
                options += '<option value="'+r+'" />';
            });

            datalist.innerHTML = options;
            document.getElementById('createRegionId').value = '';
            document.getElementById('createRegionId').placeholder = "Region_Plot_" + (window.regionId+1);
        };

        updateRegionLayerList = function() {
            var selectListIds = ['regionList_delete', 'regionEntry_add', 'regionEntry_remove', 'regionEntry_select'];

            selectListIds.forEach( function(selectId) {
                var selectBox = document.getElementById(selectId);

                for (var i = selectBox.options.length - 1; i > 0; i--) {
                     selectBox.remove(i);
                }
                window.regions.forEach(function (r) {
                    var option = document.createElement('option');
                    option.value = r;
                    option.text = r;
                    selectBox.appendChild(option);
                });

                selectBox.getElementsByTagName('option')[0].selected = 'selected';
            });

            updateDataList();
        };

        deleteRegionLayer = function() {
            var selectBox = document.getElementById('regionList_delete');

            if (selectBox.selectedIndex !== 0) {
                var selectedLayerId = selectBox.options[selectBox.selectedIndex].value;

                window.regions.splice(selectBox.selectedIndex - 1, 1);
                updateRegionLayerList();

                firefly.action.dispatchDeleteRegionLayer(selectedLayerId, 'regiontest');
                firefly.action.dispatchDeleteRegionLayer(selectedLayerId, null, dispatcher = window.ffViewer.dispatch);
            }
        };

        addRegionEntry = function() {
            var selectBox=document.getElementById('regionEntry_add');
            var selectedLayerId = selectBox.options[selectBox.selectedIndex].value;
            var addRegions = document.getElementById('moreRegionContent').value.split('\n').filter(function(r) { return (r.length !== 0);});

            selectBox.getElementsByTagName('option')[0].selected = 'selected';

            firefly.action.dispatchAddRegionEntry(selectedLayerId, addRegions, 'regiontest', null, {});
            if (selectedLayerId === 'Region Layers:') {
                firefly.action.dispatchAddRegionEntry(null, addRegions, null, null, {}, dispatcher = window.ffViewer.dispatch);
            } else {
                firefly.action.dispatchAddRegionEntry(selectedLayerId, addRegions, null, null, {}, dispatcher = window.ffViewer.dispatch);
            }
        };

        selectRegion = function() {
            var selectBox=document.getElementById('regionEntry_select');
            var selectedLayerId = selectBox.options[selectBox.selectedIndex].value;
            var selRegions = document.getElementById('selectRegionContent').value.split('\n').filter(function(r) { return (r.length !== 0);});

            if (selectedLayerId) {
                firefly.action.dispatchSelectRegion(selectedLayerId, selRegions);
                firefly.action.dispatchSelectRegion(selectedLayerId, selRegions, dispatcher = window.ffViewer.dispatch);
            }
        };

        removeRegionEntry = function() {
            var selectBox=document.getElementById('regionEntry_remove');
            var selectedLayerId = selectBox.options[selectBox.selectedIndex].value;
            var removeRegions = document.getElementById('moreRegionContent').value.split('\n').filter(function(r) { return (r.length !== 0);});

            selectBox.getElementsByTagName('option')[0].selected = 'selected';
            firefly.action.dispatchRemoveRegionEntry(selectedLayerId, removeRegions);
            firefly.action.dispatchRemoveRegionEntry(selectedLayerId, removeRegions, window.ffViewer.dispatch);
        };

        plotRemote= function() {
            firefly.getViewer().showImage({plotId: 'xxq',
                Service: 'TWOMASS',
                Title  : '2mass from service',
                ZoomType : 'LEVEL',
                initZoomLevel : 2,
                SurveyKey  : 'k',
                WorldPt    : '10.68479;41.26906;EQ_J2000',
                RangeValues : firefly.util.image.serializeSimpleRangeValues("Sigma",-1,2,"Linear"),
                SizeInDeg  : '.12'
            })
        }
   }
   
</script>

<!-- to try a container: <script  type="text/javascript" src="http://localhost:8090/firefly/firefly_loader.js"></script>-->

<script  type="text/javascript" src="../firefly_loader.js"></script>


