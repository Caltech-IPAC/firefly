<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta charset="UTF-8">
    <title>Upper Limits - Firefly</title>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>


<div style="width: 500px; padding: 50px 0 0 20px;">
    <h2>
    Sample SED Plot: ARP 220
    </h2>
</div>

<div id="table" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="plotly" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>

<script type="text/javascript">
    if (!window.firefly) window.firefly= {};
    window.firefly.options= {charts: {singleTraceUI: true, upperLimitUI: true}};
</script>

<script type="text/javascript">
    {
        onFireflyLoaded= function(firefly) {

            var tblReq = firefly.util.table.makeFileRequest(
                'SED: ARP-220', // title
                'http://ned.ipac.caltech.edu/cgi-bin/datasearch?ebars_spec=ebars&label_spec=no&x_spec=freq&y_spec=Fnu_jy&xr=-2&objname=ARP+220&objid=58863&search_type=Photo_id&meas_type=bot&of=xml_main&objname=ARP+220&objid=58863&search_type=Photo_id&meas_type=bot',  // source
                null,  // alt_source
                //{filters: '"NED Photometry Measurement" is null or "NED Photometry Measurement" < 6.76E-09'}
                {pageSize: 50, filters: '"NED Units" like \'Jy\''} // options
            );
            var tblId = tblReq.tbl_id;

            // set data format for chart data (default '%.6f is not suitable to display numbers like 1.3e-9)
            tblReq.META_INFO['col.data.0.x.FmtDisp']= '%g';
            tblReq.META_INFO['col.data.0.y.FmtDisp']= '%g';
            tblReq.META_INFO['col.fireflyData.0.yMax.FmtDisp']= '%g';
            firefly.showTable('table', tblReq);

            var data = [{
                name: 'sed',
                tbl_id: tblId,
                //text: 'tables::"No."', // does not display - probably not needed, if chart and table are connected
                x: 'tables::log(Frequency)',
                y: 'tables::log("NED Photometry Measurement")',
                firefly: {
                    // waiting for NED to provide us a numeric column
                    // the expression is for illustration purposes only: only a limited set of DB expressions is supported in chart options
                    yMax: 'tables::log(CASEWHEN(IFNULL("NED Photometry Measurement", 0) > 0, NULL, 10))'
                },
                mode: 'markers'
            }];

            var fireflyData = [{
                // waiting for NED to provide us a numeric column
                // the expression is for illustration purposes only:
                // only a limited set of DB expressions is supported in chart options
                // with this expression, user can not modify apply new chart options
                yMax: 'tables::log(CASEWHEN(IFNULL("NED Photometry Measurement", 0) > 0, NULL, 10))'

            }];

            var layout = {
                xaxis: {
                    title: 'log(<em>v</em> [Hz])',
                },
                yaxis: {
                    title: 'log(F<sub><em>v</em></sub> [Jy])',
                }
            };

            firefly.showChart('plotly', {data: data, fireflyData: fireflyData, layout: layout});
        }
    }


</script>


<script  type="text/javascript" src="../firefly_loader.js"></script>


</body>
</html>