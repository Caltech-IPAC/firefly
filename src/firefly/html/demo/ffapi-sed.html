<!doctype html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<html>

<head>
    <meta charset="UTF-8">
    <title>Upper Limits - Firefly</title>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>


<div style="width: 500px; padding: 50px 0 0 20px;">
    <h2>
    Sample SED Charts
    </h2>
</div>

<div>
    <div id="table3" style="display: inline-block; width: 500px; height: 400px; border: solid 1px;"></div>
    <div id="sedchart3" style="display: inline-block; width: 500px; height: 400px; border: solid 1px;"></div>
</div>
<br/><br/>
<div>
    <div id="table4" style="display: inline-block; width: 500px; height: 400px; border: solid 1px;"></div>
    <div id="sedchart4" style="display: inline-block; width: 500px; height: 400px; border: solid 1px;"></div>
</div>
<br/><br/>
<div id="table" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="sedchart" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>

<div id="table2" style="width: 800px; height: 550px; border: solid 1px;"></div>
<br/><br/>
<div id="sedchart2" style="width: 800px; height: 550px; border: solid 1px;"></div>

<br/><br/>

<script type="text/javascript">
    if (!window.firefly) window.firefly= {};
    window.firefly.options= {charts: {singleTraceUI: true, upperLimitUI: true}};
</script>

<script type="text/javascript">
    {
        onFireflyLoaded= function(firefly) {

            var tblReq = firefly.util.table.makeFileRequest(
                'SED: ARP-220 raw', // title
                'http://ned.ipac.caltech.edu/cgi-bin/datasearch?ebars_spec=ebars&label_spec=no&x_spec=freq&y_spec=Fnu_jy&xr=-2&objname=ARP+220&objid=58863&search_type=Photo_id&meas_type=bot&of=xml_main&objname=ARP+220&objid\
=58863&search_type=Photo_id&meas_type=bot',  // source
                null,  // alt_source
                {filters: '"NED Units" like \'Jy\''} // options
            );
            //tblReq.inclCols = '"No.","Frequency","Flux Density","Upper limit of Flux Density","Lower limit of uncertainty","Upper limit of uncertainty"'

            var wrapperReq = firefly.util.table.makeTblRequest('IpacTableFromSource', 'SED: ARP-220',
                {searchRequest: tblReq}, {pageSize: 50});
            var tblId = wrapperReq.tbl_id;

            firefly.showTable('table', wrapperReq);

            firefly.showChart('sedchart', {
                data: [{
                    name: 'sed',
                    tbl_id: tblId,
                    //text: 'tables::"No."', // does not display - probably not needed, if chart and table are connected
                    x: 'tables::log("Frequency")',
                    // error_x: {
                    //     // assuming error is a fifth of the Frequency
                    //     arrayminus: 'tables::log("Frequency")-log("Frequency"-"Frequency"/5)', // error bar (minus)
                    //     array: 'tables::log("Frequency"+"Frequency"/5)-log("Frequency")', // error bar (plus)
                    // },
                    y: 'tables::log("Flux Density")',
                    error_y: {
                         arrayminus: 'tables::log("Flux Density")-log("Flux Density"-"Lower limit of uncertainty")', // error bar (minus)
                         array: 'tables::log("Flux Density"+"Upper limit of uncertainty")-log("Flux Density")', // error bar (plus)
                    },
                    firefly: {
                        yMax: 'tables::log("Upper limit of Flux Density")'
                    },
                    mode: 'markers'
                }],
                layout: {
                    xaxis: {
                        title: 'log(<em>v</em> [Hz])',
                    },
                    yaxis: {
                        title: 'log(F<sub><em>v</em></sub> [Jy])',
                    }
                }
            });


            // Another example: the table has numeric columns

            var tblReq2 = firefly.util.table.makeFileRequest(
                'SED: M31', // title
                'http://localhost:8080/firefly/demo/sedSample.xml',  // source
                null,  // alt_source
                {} // options
            );
            var tblId1 = tblReq2.tbl_id;

            firefly.showTable('table2', tblReq2);

            firefly.showChart('sedchart2', {
                data: [{
                    name: 'sed',
                    tbl_id: tblId1,
                    x: 'tables::Frequency',
                    y: 'tables::NEDPhotometryMeasurement',
                    error_y: {
                        array: 'tables::NEDUncertainty', // error bar (symmetrical or plus)
                    },
                    firefly: {
                        yMax: 'tables::NEDUpperLimit'
                    },
                    mode: 'markers'
                }],
                layout: {
                    xaxis: {
                        title: 'v [Hz]',
                        type: 'log'
                    },
                    yaxis: {
                        title: 'F(v) [Jy]',
                        type: 'log'
                    }
                }
            });

            // Another example: from VizieR for Simbad name set rs at 1 arcsec

            var tblReq3 = firefly.util.table.makeFileRequest(
                'VisirR SED: HD878', // title
                'http://vizier.u-strasbg.fr/viz-bin/sed?-c=HD878&-c.rs=1',  // source
                null,  // alt_source
                {META_INFO:{"col._ID.Visibility": "hide"}, "pageSize":100} // options
            );
            var tblId1 = tblReq3.tbl_id;

            firefly.showTable('table3', tblReq3);

            firefly.showChart('sedchart3', {
                data: [{
                    name: 'sed',
                    tbl_id: tblId1,
                    x: 'tables::"_sed_freq"',
                    y: 'tables::_sed_flux',
                    error_y: {
                        array: 'tables::_sed_eflux', // error bar (symmetrical or plus)
                    },
                    mode: 'markers'
                }],
                layout: {
                    title: 'Spectral Energy Distribution from VizieR',
                     xaxis: {
                         title: '<em>v</em> [GHz]',
                         type: 'log',
                         tickwidth: 2,
                         linewidth: 2,
                         tickmode: "auto",
                         showgrid: true,
                         ticks: "inside",
                         mirror: "allticks"
                     },
                     yaxis: {
                         title: 'F<sub><em>v</em></sub> [Jy]',
                         type: 'log',
                         tickwidth: 2,
                         linewidth: 2,
                         tickmode: "auto",
                         showgrid: true,
                         ticks: "inside",
                         mirror: "allticks"
                     }
                }
            });

            // Another example: from VizieR  for coordinates set rs at 5 arcsec

            var tblReq4 = firefly.util.table.makeFileRequest(
                'VisirR SED: Coordinate test', // title
                'http://vizier.u-strasbg.fr/viz-bin/sed?-c=187.2778914224,2.0523984558&-c.rs=5',  // source
                null,  // alt_source
                {} // options
            );
            var tblId1 = tblReq4.tbl_id;

            firefly.showTable('table4', tblReq4);

            firefly.showChart('sedchart4', {
                data: [{
                    name: 'sed',
                    tbl_id: tblId1,
                    x: 'tables::"_sed_freq"*power(10,9)',
                    y: 'tables::_sed_flux',
                    error_y: {
                        array: 'tables::_sed_eflux', // error bar (symmetrical or plus)
                    },
                    mode: 'markers'
                }],
                layout: {
                    title: 'Spectral Energy Distribution from VizieR',
                     xaxis: {
                         title: '<em>v</em> [Hz]',
                         type: 'log',
                         tickwidth: 2,
                         linewidth: 2,
                         tickmode: "auto",
                         showgrid: true,
                         ticks: "inside",
                         mirror: "allticks"
                     },
                     yaxis: {
                     title: 'F<sub><em>v</em></sub> [Jy]',
                     type: 'log',
                     tickwidth: 2,
                     linewidth: 2,
                     tickmode: "auto",
                     showgrid: true,
                     ticks: "inside",
                     mirror: "allticks"
                     }
                }
            });

        }
    }
    
</script>


<script  type="text/javascript" src="../firefly_loader.js"></script>


</body>
</html>