<!DOCTYPE html>

<!--
  ~ License information at https://github.com/Caltech-IPAC/firefly/blob/master/License.txt
  -->

<!--
  This is a test for Python (external task) launcher.
  Firefly supports getting JSON data, table, or image from an external task
  -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Testing getJSONFromTask</title>
</head>
<body>
    <div id="chartHere"  style="display:inline-block; width: 800px; height: 350px;
                                border: solid 1px;"></div>
    <br><br>
    <div id="tableHere"  style="display:inline-block; width: 800px; height: 350px;
                                border: solid 1px;"></div>
    <br><br>
    <div id="imageHere" style="width: 350px; height: 350px;"></div>
</body>

<script type="text/javascript">
    {
        onFireflyLoaded = function (firefly) {

            // json - show histogram, generated by firefly/python/SamplePythonLauncher.py
            var launcher = 'python';
            var task = 'JsonTaskToGetHistogramData';
            var taskParams = {'numbins': 10};
            firefly.getJsonFromTask(launcher, task, taskParams)
                    .then(function (histdata) {
                        console.log('Returned JSON: ' + JSON.stringify(histdata));
                        firefly.util.renderDOM("chartHere", firefly.ui.Histogram,
                                {
                                    desc: 'Histogram data returned from Python JSON task',
                                    binColor: '#3d3033',
                                    height: 350,
                                    data: histdata
                                });
                    })
                    .catch(function (reason) {
                        console.error('Error fetching JSON data from ' + launcher + ' task ' + task + ': ' + reason);
                        document.getElementById('chartHere').innerHTML = '<p style="color:red">'+reason+'</p>';
                    });

            // table - show table, generated by firefly/python/SamplePythonLauncher.py
            var tblReq = firefly.util.table.makeTblRequest('TableFromExternalTask', 'Table from Python task',
                    { launcher : 'python', task : 'TableTask', taskParams : {p1: 1, p2: 2} }, // search parameters
                    { pageSize: 15} // table options
            );
            firefly.showTable('tableHere', tblReq);

            // image - show FITS image, generated by firefly/python/SamplePythonLauncher.py
            var req = {
                id : 'FileFromExternalTask',
                launcher : 'python',
                task : 'someImageTask',
                taskParams : {p1:1,p2:2},
                Title : 'FITS from Python task',
                ColorTable : 2
            };
            firefly.showImage('imageHere', req);
        }
    }
</script>

<script  type="text/javascript" src="../firefly_loader.js"></script>


</html>